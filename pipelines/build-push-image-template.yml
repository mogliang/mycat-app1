parameters:
- name: version
  displayName: 'build version. Required'
  type: string
- name: registry
  displayName: 'Registry. Required'
  type: string
- name: component
  displayName: 'component name. Required'
  type: string
- name: imageName
  displayName: 'image name. Required'
  type: string

steps:
- task: Docker@2
  displayName: login acr ${{ parameters.registry }}
  inputs:
    containerRegistry: '${{ parameters.registry }}'
    command: 'login'
- task: Docker@2
  displayName: Build image ${{ parameters.imageName }}
  inputs:
    command: build
    dockerfile: '$(Build.SourcesDirectory)/src/${{ parameters.component }}/dockerfile'
    buildContext: '$(Build.SourcesDirectory)/src'
    arguments: '--build-arg VERSION=${{ parameters.version }}'
    repository: ${{ parameters.imageName }}
    tags: |
      ${{ parameters.version }}
- task: Docker@2
  displayName: Push image ${{ parameters.imageName }}
  inputs:
    containerRegistry: '${{ parameters.registry }}'
    repository: '${{ parameters.imageName }}'
    command: 'push'
- script: echo build succeed
  displayName: ${{ parameters.imageName }}:${{ parameters.version }} pushed